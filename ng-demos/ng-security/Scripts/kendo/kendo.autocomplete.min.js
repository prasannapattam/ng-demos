/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

!function(e,define){define(["./kendo.list.min","./kendo.mobile.scroller.min"],e)}(function(){return function(e,t){function n(e,t,n){return n?t.substring(0,e).split(n).length-1:0}function i(e,t,i){return t.split(i)[n(e,t,i)]}function o(e,t,i,o){var a=t.split(o);return a.splice(n(e,t,o),1,i),o&&""!==a[a.length-1]&&a.push(""),a.join(o)}var a=window.kendo,r=a.support,l=a.caret,s=a._activeElement,u=r.placeholder,c=a.ui,d=c.List,p=a.keys,f=a.data.DataSource,h="aria-disabled",v="aria-readonly",m="k-state-default",g="disabled",k="readonly",_="k-state-focused",b="k-state-selected",w="k-state-disabled",y="k-state-hover",$=".kendoAutoComplete",M="mouseenter"+$+" mouseleave"+$,T=e.proxy,S=d.extend({init:function(t,n){var i,o=this;o.ns=$,n=e.isArray(n)?{dataSource:n}:n,d.fn.init.call(o,t,n),t=o.element,n=o.options,n.placeholder=n.placeholder||t.attr("placeholder"),u&&t.attr("placeholder",n.placeholder),o._wrapper(),o._loader(),o._dataSource(),o._ignoreCase(),t[0].type="text",i=o.wrapper,o._popup(),t.addClass("k-input").on("keydown"+$,T(o._keydown,o)).on("paste"+$,T(o._search,o)).on("focus"+$,function(){o._prev=o._accessor(),o._placeholder(!1),i.addClass(_)}).on("focusout"+$,function(){o._change(),o._placeholder(),i.removeClass(_)}).attr({autocomplete:"off",role:"textbox","aria-haspopup":!0}),o._enable(),o._old=o._accessor(),t[0].id&&t.attr("aria-owns",o.ul[0].id),o._aria(),o._placeholder(),a.notify(o)},options:{name:"AutoComplete",enabled:!0,suggest:!1,template:"",dataTextField:"",minLength:1,delay:200,height:200,filter:"startswith",ignoreCase:!0,highlightFirst:!1,separator:null,placeholder:"",animation:{},value:null},_dataSource:function(){var e=this;e.dataSource&&e._refreshHandler?e._unbindDataSource():(e._refreshHandler=T(e.refresh,e),e._progressHandler=T(e._showBusy,e)),e.dataSource=f.create(e.options.dataSource).bind("change",e._refreshHandler).bind("progress",e._progressHandler)},setDataSource:function(e){this.options.dataSource=e,this._dataSource()},events:["open","close","change","select","filtering","dataBinding","dataBound"],setOptions:function(e){d.fn.setOptions.call(this,e),this._template(),this._accessors(),this._aria()},_editable:function(e){var t=this,n=t.element,i=t.wrapper.off($),o=e.readonly,a=e.disable;o||a?(i.addClass(a?w:m).removeClass(a?m:w),n.attr(g,a).attr(k,o).attr(h,a).attr(v,o)):(i.addClass(m).removeClass(w).on(M,t._toggleHover),n.removeAttr(g).removeAttr(k).attr(h,!1).attr(v,!1))},close:function(){var e=this,t=e._current;t&&t.removeClass(b),e.current(null),e.popup.close()},destroy:function(){var e=this;e.element.off($),e.wrapper.off($),d.fn.destroy.call(e)},refresh:function(){var n,i=this,o=i.ul[0],r=i.popup,l=i.options,u=i._data(),c=u.length,d=i.element[0]===s();i._angularItems("cleanup"),i.trigger("dataBinding"),o.innerHTML=a.render(i.template,u),i._height(c),r.visible()&&r._position(),c&&(l.highlightFirst&&i.current(e(o.firstChild)),l.suggest&&d&&i.suggest(e(o.firstChild))),i._open&&(i._open=!1,n=c?"open":"close",i._typing&&!d&&(n="close"),r[n](),i._typing=t),i._touchScroller&&i._touchScroller.reset(),i._makeUnselectable(),i._hideBusy(),i._angularItems("compile"),i.trigger("dataBound")},select:function(e){this._select(e)},search:function(e){var t,n=this,o=n.options,a=o.ignoreCase,r=o.separator;e=e||n._accessor(),n._current=null,clearTimeout(n._typing),r&&(e=i(l(n.element)[0],e,r)),t=e.length,(!t||t>=o.minLength)&&(n._open=!0,n._filterSource({value:a?e.toLowerCase():e,operator:o.filter,field:o.dataTextField,ignoreCase:a}))},suggest:function(e){var i,o=this,a=o._last,r=o._accessor(),u=o.element[0],c=l(u)[0],f=o.options.separator,h=r.split(f),v=n(c,r,f),m=c;return a==p.BACKSPACE||a==p.DELETE?(o._last=t,t):(e=e||"","string"!=typeof e&&(i=d.inArray(e[0],o.ul[0]),e=i>-1?o._text(o._data()[i]):""),0>=c&&(c=r.toLowerCase().indexOf(e.toLowerCase())+1),i=r.substring(0,c).lastIndexOf(f),i=i>-1?c-(i+f.length):c,r=h[v].substring(0,i),e&&(i=e.toLowerCase().indexOf(r.toLowerCase()),i>-1&&(e=e.substring(i+r.length),m=c+e.length,r+=e),f&&""!==h[h.length-1]&&h.push("")),h[v]=r,o._accessor(h.join(f||"")),u===s()&&l(u,c,m),t)},value:function(e){return e===t?this._accessor():(this._accessor(e),this._old=this._accessor(),t)},_accessor:function(e){var n=this,i=n.element[0];return e===t?(e=i.value,i.className.indexOf("k-readonly")>-1&&e===n.options.placeholder?"":e):(i.value=null===e?"":e,n._placeholder(),t)},_accept:function(e){var t=this.element;this._focus(e),l(t,t.val().length)},_keydown:function(t){var n=this,i=n.ul[0],o=t.keyCode,a=n._current,r=n.popup.visible();n._last=o,o===p.DOWN?(r&&n._move(a?a.next():e(i.firstChild)),t.preventDefault()):o===p.UP?(r&&n._move(a?a.prev():e(i.lastChild)),t.preventDefault()):o===p.ENTER||o===p.TAB?(o===p.ENTER&&n.popup.visible()&&t.preventDefault(),n._accept(a)):o===p.ESC?(n.popup.visible()&&t.preventDefault(),n.close()):n._search()},_move:function(e){var t=this;e=e[0]?e:null,t.current(e),t.options.suggest&&t.suggest(e)},_hideBusy:function(){var e=this;clearTimeout(e._busy),e._loading.hide(),e.element.attr("aria-busy",!1),e._busy=null},_showBusy:function(){var e=this;e._busy||(e._busy=setTimeout(function(){e.element.attr("aria-busy",!0),e._loading.show()},100))},_placeholder:function(e){if(!u){var n,i=this,o=i.element,a=i.options.placeholder;if(a){if(n=o.val(),e===t&&(e=!n),e||(a=n!==a?n:""),n===i._old&&!e)return;o.toggleClass("k-readonly",e).val(a),a||o[0]!==document.activeElement||l(o[0],0,0)}}},_search:function(){var e=this;clearTimeout(e._typing),e._typing=setTimeout(function(){e._prev!==e._accessor()&&(e._prev=e._accessor(),e.search())},e.options.delay)},_select:function(t){var n,i,a=this,r=a.options.separator,s=a._data();t=e(t),t[0]&&!t.hasClass(b)&&(i=d.inArray(t[0],a.ul[0]),i>-1&&(s=s[i],n=a._text(s),r&&(n=o(l(a.element)[0],a._accessor(),n,r)),a._accessor(n),a._prev=a._accessor(),a.current(t.addClass(b))))},_loader:function(){this._loading=e('<span class="k-icon k-loading" style="display:none"></span>').insertAfter(this.element)},_toggleHover:function(t){e(t.currentTarget).toggleClass(y,"mouseenter"===t.type)},_wrapper:function(){var e,t=this,n=t.element,i=n[0];e=n.parent(),e.is("span.k-widget")||(e=n.wrap("<span />").parent()),e.attr("tabindex",-1),e.attr("role","presentation"),e[0].style.cssText=i.style.cssText,n.css({width:"100%",height:i.style.height}),t._focused=t.element,t.wrapper=e.addClass("k-widget k-autocomplete k-header").addClass(i.className)}});c.plugin(S)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});